!function(c,l){var t=c(document),T=Customify_Layout_Builder.is_rtl,i=function(n){var e={controlId:"",cols:12,cellHeight:45,items:[],container:null,ready:!1,devices:{desktop:"Desktop",mobile:"Mobile/Tablet"},activePanel:"desktop",panels:{},activeRow:"main",draggingItem:null,getTemplate:_.memoize(function(){var a=this,o={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e,t,i){return _.isUndefined(t)&&(t="tmpl-customize-control-"+a.type),!_.isUndefined(i)&&_.isString(i)?o.variable=i:o.variable="data",_.template(c("#"+t).html(),null,o)(e)}}),drag_drop:function(){var n=this;c(".customify--device-panel",n.container).each(function(){var i=c(this),a=i.data("device"),o=[];n.panels[a]={},c(".customify--cb-items",i).each(function(e){var t,i=c(this).attr("data-id")||"";t=i?"_sid_"+a+"-"+i:"_sid_"+a+e,c(this).attr("id",t),o[e]="#"+t}),c(".grid-stack",i).each(function(){var e=c(this).attr("data-id")||"";n.panels[a][e]=c(this),c(this).droppable({out:function(e,t){},over:function(e,t){},drop:function(e,t){var i=c(this);n.gridster(i,t,e),n.save()}})});var e=c("#_sid_mobile-sidebar",i),t=e.attr("id")||!1;c(".customify-available-items .grid-stack-item",i).draggable({revert:"invalid",connectToSortable:!!t&&"#"+t,start:function(e,t){c("body").addClass("builder-item-moving"),c(".customify--cb-items",i).css("z-index",""),t.helper.parent().css("z-index",9999)},stop:function(e,t){c("body").removeClass("builder-item-moving"),c(".customify--cb-items",i).css("z-index",""),t.helper.parent().css("z-index","")}}),0<e.length&&(e.sortable({revert:!0,change:function(e,t){n.save()},receive:function(e,t){c(this).find(".grid-stack-item").removeAttr("style").attr("data-gs-width",1),n.save()}}),n.panels[a].sidebar=e),c(".customify-available-items .grid-stack-item",i).resizable({handles:"w, e",stop:function(e,t){n.setGridWidth(t.element.parent(),t),n.save()}})})},sortGrid:function(e){c(".grid-stack-item",e).each(function(){var e=c(this),t=e.attr("data-gs-x")||0;t=parseInt(t);var i=e.next();if(0<i.length){var a=i.attr("data-gs-x")||0;(a=parseInt(a))<t&&e.insertAfter(i)}})},getX:function(e){var t=e.attr("data-gs-x")||0;return parseInt(t)},getW:function(e,t){var i;return _.isUndefined(t)&&(t=!1),i=t?e.attr("data-df-width")||1:e.attr("data-gs-width")||1,parseInt(i)},gridGetItemInfo:function(e,t,i){var a,o=this.getX(e),n=this.getW(e),s=0,r=0,c=!1;for(a=o-1;0<=a&&!c;)0===t[a]?s++:c=!0,a--;for(c=!1,a=o+n,console.log("start R: "+a);a<this.cols&&!c;)0===t[a]?r++:c=!0,a++;return{flag:t,x:o,w:n,item:e,before:s,after:r,id:e.attr("data-id")||"",wrapper:i}},updateItemsPositions:function(e){for(var t=this.cols,i=0;i<=t;i++)"object"!=typeof e[i]&&"function"!=typeof e[i]||e[i].attr("data-gs-x",i)},gridster:function(e,t){var i,m=[],a=this,g=this.cols,p=function(e){for(var t=e.x,i=e.w,a=e.el,o=t;o<t+i;o++)m[o]=o===t?a:1},o=function(e){for(var t=e.x,i=e.w,a=(e.el,t);a<t+i;a++)m[a]=0},h=function(e,t){for(var i=0,a=e;a<g;a++)if(0===m[a])i++;else if(t)return i;return i},w=function(e,t){var i=0;void 0===t&&(t=!1);for(var a=e;0<=a;a--)if(0===m[a])i++;else if(t)return i;return i},b=function(e){return 0===m[e]},y=function(e,t){for(var i=e;i<e+t;){if(0!==m[i])return!1;i++}return!0},x=function(e){if(e<0)return{x:-1,w:1};var t,i,a,o=-1;if(m[e]<=1)for(t=e,a=!1;0<=t&&!a;)1!==m[t]&&0!==m[t]&&(o=t,a=!0),t--;else o=e;for(t=o+1,i=o;1===m[t];)i++,t++;return{x:o,w:i+1-o}},C=function(e,t){var i=m.slice(),a=w(e);if(0===a)return t;var o=x(e),n=0<=o.x?o.x+o.w-1:e,s=t;s=a<t?a:t;for(var r=0,c=0,l=n;c<=s&&0<=l;)0===m[l]&&(c++,r=l),l--;var d=[],f=0;for(l=r;l<=n;l++)(m[l]=0)!==i[l]&&(d[f]=i[l],f++);for(f=0,l=r;l<=n;l++)void 0!==d[f]?m[l]=d[f]:m[l]=0,f++;return t-s},I=function(e,t){var i=m.slice(),a=h(e);if(0===a)return t;var o=x(e),n=0<=o.x?o.x:e,s=t;s=t<=a?t:a;for(var r=e,c=0,l=n;c<s&&l<g;)0===m[l]&&(c++,r=l),l++;var d=[],f=0;for(l=n;l<=r;l++)(m[l]=0)!==i[l]&&(d[f]=i[l],f++);for(f=d.length-1,l=r;n<=l;l--)void 0!==d[f]?m[l]=d[f]:m[l]=0,f--;return t-s},k=function(){a.updateItemsPositions(m)},n=function(e,t){var i,a,o,n,s=e.x,r=e.w,c=function(){for(var e=0,t=0;t<g;t++)0===m[t]&&e++;return e}();if(console.log("emptySlots",c),console.log("Node Width",r),c<=0)return!1;if(_.isUndefined(t)&&(t=!1),!t){if(b(s)){if(y(s,n=r))return p(e),e.el.attr("data-gs-x",s),e.el.attr("data-gs-width",n),!0;for((i=r<=(a=h(s,!0))+(o=w(s-1,!0))&&r-a<=o?s-(r-a):s-o)<0&&(i=0),console.log("_re",a),console.log("_le",o),console.log("__x",i);1<=n;){if(y(i,n))return console.log({x:i,w:n}),e.x=i,e.w=n,p(e),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",n),!0;n--}}if(1===m[s]){var l=x(s);if(0<=l.x&&s>l.x+Math.floor(l.w/2)&&s>l.x&&(i=l.x+l.w,a=h(i,!0),console.log("__re",a),console.log("__re_X",i),r<=a))return p({el:e.el,x:i,w:r}),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",r),!0}}var d=0;t?0<(d=I(s,r))&&(d=C(s-1,d)):0<(d=C(s,r))&&(d=I(s-1,d)),k(),console.log("After moved",m);for(var f,u=s,v=!1;1<=r;){if(r<=c){if(y(s,r))return console.log({x:s,w:r}),p(e),e.el.attr("data-gs-x",s),e.el.attr("data-gs-width",r),!0;for(v=!1,u=s-w(s,!0),console.log("newX",u),f=u;f<g&&!v;){if(y(f,r))return console.log("Insert in While",{x:f,w:r}),p({el:e.el,x:f,w:r}),e.el.attr("data-gs-x",f),e.el.attr("data-gs-width",r),v=!0;f++}}r--}for(r=e.w,v=!1;1<=r;){for(f=0;f<g&&!v;){if(y(f,r))return console.log("Insert in While 2",{x:f,w:r}),p({el:e.el,x:f,w:r}),e.el.attr("data-gs-x",f),e.el.attr("data-gs-width",r),v=!0;f++}r--}return console.log("Insert END While",{x:f,w:r}),!1};i=(m=(a=this).getFlag(e)).slice();var s=e.offset();a.draggingItem=t.draggable;var r,c,l,d=e.width(),f=d/a.cols,u=0,v=t.offset;r=a.getW(t.draggable,!0),c=t.draggable.width(),console.log("DROP ITEM WIDTH",r);var z=a.getX(t.draggable);T&&o({el:t.draggable,x:z,w:r});var P,D=0,S=0,A=!1;if(t.draggable.parent().is(e)?(l=!0,console.log("Item in this row")):(l=!1,console.log("Not in this row")),T?(D=Math.round((s.left+d+10-event.clientX)/f),(S=Math.round((s.left+d-(v.left+c+10))/f))<0&&(S=0)):(D=Math.round((event.clientX-s.left)/f),(S=Math.round((v.left-s.left-10)/f))<0&&(S=0)),D>a.cols&&(D=a.cols),P=u=S,T)if(b(P))u=S,A=!0;else for(;P<a.cols&&!A;)b(P)?A=!0:P++;else if(b(u))u=S,A=!0;else{for(;u<=D&&!A;)b(u)?A=!0:u++;D<u&&(u=D)}if(A||(u=l?S:D),u<0&&(u=0),console.log("Flag R",_.clone(m).reverse()),u+r>=a.cols){for(A=!0,P=u;P+r>a.cols&&A;)b(P)?P--:A=!1,console.log("loop_i",P);console.log("Find new _i, w: "+r,P),u=P}delete A,console.log("DROP Cursor",D),console.log("DROP row x cacl",u);var W={el:t.draggable,x:u,w:r};W.x<=0&&(W.x=0);var G=!1;l?(W.x=parseInt(t.draggable.attr("data-gs-x")||0),W.w=parseInt(t.draggable.attr("data-gs-width")||1),console.log("swap node",W),function(e,t){e.x;var i=e.w;if(o(e),console.log("Swap newX",t),console.log("Before Swap FLAG",m),y(t,i))return p({el:e.el,x:t,w:i});x(t);n({el:e.el,x:t,w:e.w},!0)}(W,u),G=!0):(G=n(W),console.log("Insert node")),G?(t.draggable.removeClass("item-from-list"),e.append(t.draggable),t.draggable.removeAttr("style"),console.log("DID Flag: ",m),a.draggingItem=null):(t.draggable.removeAttr("style"),console.log("Can not insert"),m=i),k(),a.updateAllGrids()},updateAllGrids:function(){var i=this;_.each(i.panels[i.activePanel],function(e,t){i.updateGridFlag(e)})},setGridWidth:function(e,t){var i,a,o=this,n=t.element,s=e.width(),r=t.size.width,c=t.originalSize.width,l=s/o.cols;T?(i=t.originalPosition.left>t.position.left,a=c!==r):(i=t.originalPosition.left>t.position.left,a=t.originalPosition.left<t.position.left);var d,f,u,v=t.originalElement.attr("data-gs-width")||1,m=t.originalElement.attr("data-gs-x")||0;v=parseInt(v),m=parseInt(m);var g,p,h,w=o.getFlag(e),b=o.gridGetItemInfo(t.originalElement,w,e);if(i)return T?(g=t.originalPosition.left-t.position.left,(d=Math.ceil(g/l))>b.after&&(d=b.after),u=v+d,n.attr("data-gs-x",m).removeAttr("style")):(g=t.originalPosition.left-t.position.left,(d=Math.ceil(g/l))>b.before&&(d=b.before),f=m-d,u=v+d,n.attr("data-gs-x",f).removeAttr("style")),n.attr("data-gs-width",u).removeAttr("style"),void o.updateGridFlag(e);if(a)return T?(p=r-c,(d=Math.ceil(p/l))>b.before&&(d=b.before),u=v+d,(f=m-d)<=0&&(f=0)):(p=t.position.left-t.originalPosition.left,(u=v-(d=Math.ceil(p/l)))<=0&&(u=1,d=0),f=m+d),n.attr("data-gs-x",f).removeAttr("style"),n.attr("data-gs-width",u).removeAttr("style"),void o.updateGridFlag(e);b.x;r<t.originalSize.width?h=Math.floor(r/l):(h=Math.ceil(r/l),b.x+h>b.x+b.w+b.after&&(h=b.w+b.after)),h<=0&&(h=1),n.attr("data-gs-width",h).removeAttr("style"),o.updateGridFlag(e)},getFlag:function(e){var t,i=e.data("gridRowFlag")||[];if(_.isEmpty(i)){for(t=0;t<this.cols;t++)i[t]=0;e.data("gridRowFlag",i)}return i},updateGridFlag:function(e){var a,o=this,n=[];for(a=0;a<o.cols;a++)n[a]=0;return c(".grid-stack-item",e).each(function(e){c(this).removeAttr("style");var t=o.getX(c(this)),i=o.getW(c(this));for(a=t;a<t+i;a++)n[a]=a===t?c(this):1}),e.data("gridRowFlag",n),o.updateItemsPositions(n),o.sortGrid(e),n},addNewWidget:function(e,t){var i=this,a=i.container.find(".customify--device-panel.customify--panel-"+i.activePanel),o=t;_.isObject(o)||(o=a.find(".customify--cb-items").first());var n=e;n.draggable({revert:"invalid",appendTo:a,scroll:!1,zIndex:99999,handle:".grid-stack-item-content",start:function(e,t){c("body").addClass("builder-item-moving"),c(".customify--cb-items",a).css("z-index",""),t.helper.parent().css("z-index",9999)},stop:function(e,t){c("body").removeClass("builder-item-moving"),c(".customify--cb-items",a).css("z-index",""),i.save()},drag:function(e,t){}}).resizable({handles:"w, e",start:function(e,t){t.originalElement.css({right:"auto",left:t.position.left})},stop:function(e,t){i.setGridWidth(t.element.parent(),t),i.save()}}),o.append(n),i.updateGridFlag(o)},addPanel:function(e){var t=this.getTemplate(),i="tmpl-customify--cb-panel";if(0!=c("#"+i).length)return _.isObject(n.rows)||(n.rows={}),'<div class="customify--device-panel customify-vertical-panel customify--panel-'+e+'" data-device="'+e+'">'+t({device:e,id:n.id,rows:n.rows},i)+"</div>"},addDevicePanels:function(){var a=this;_.each(a.devices,function(e,t){var i=a.addPanel(t);c(".customify--cb-devices-switcher",a.container).append('<a href="#" class="switch-to-'+t+'" data-device="'+t+'">'+e+"</a>"),c(".customify--cb-body",a.container).append(i)})},addItem:function(e){var t=this.getTemplate(),i="tmpl-customify--cb-item";if(0!=c("#"+i).length){var a=t(e,i);return c(a)}},addAvailableItems:function(){var s=this;_.each(s.devices,function(e,o){var n=c('<div class="customify-available-items" data-device="'+o+'"></div>');c(".customify--panel-"+o,s.container).append(n),_.each(s.items,function(e){var t=!0;if(!_.isUndefined(e.devices)&&!_.isEmpty(e.devices))if(_.isString(e.devices))e.devices!=o&&(t=!1);else{var i=!1;_.each(e.devices,function(e){o==e&&(i=!0)}),i||(t=!1)}if(t){var a=s.addItem(e);n.append(a)}})})},switchToDevice:function(e,t){var i=this;1<_.size(i.devices)?(c(".customify--cb-devices-switcher a",i.container).removeClass("customify--tab-active"),c(".customify--cb-devices-switcher .switch-to-"+e,i.container).addClass("customify--tab-active"),c(".customify--device-panel",i.container).addClass("customify--panel-hide"),c(".customify--device-panel.customify--panel-"+e,i.container).removeClass("customify--panel-hide"),i.activePanel=e):c(".customify--cb-devices-switcher a",i.container).addClass("customify--tab-active"),(_.isUndefined(t)||t)&&("desktop"==e?c("#customize-footer-actions .preview-desktop").trigger("click"):c("#customize-footer-actions .preview-mobile").trigger("click"))},addExistingRowsItems:function(){var s=this,t=l.control(s.controlId).params.value;_.isObject(t)||(t={}),_.each(s.panels,function(o,n){var e={};_.isObject(t[n])&&(e=t[n]),_.each(e,function(e,a){_.isUndefined(e)||_.each(e,function(e,t){var i=c('.customify-available-items[data-device="'+n+'"] .grid-stack-item[data-id="'+e.id+'"]').first();i.attr("data-gs-width",e.width),i.attr("data-gs-x",e.x),i.removeClass("item-from-list"),s.addNewWidget(i,o[a])})})}),s.ready=!0},focus:function(){this.container.on("click",".customify--cb-item-setting, .customify--cb-item-name, .item-tooltip",function(e){e.preventDefault();var t=c(this).data("section")||"",i=c(this).attr("data-control")||"",a=!1;i&&(_.isUndefined(l.control(i))||(l.control(i).focus(),a=!0)),a||t&&!_.isUndefined(l.section(t))&&(l.section(t).focus(),a=!0)}),this.container.on("click",".customify--cb-row-settings",function(e){e.preventDefault();var t=c(this).attr("data-id")||"",i=n.id+"_"+t;_.isUndefined(l.section(i))||l.section(i).focus()})},remove:function(){var a=this;t.on("click",".customify--device-panel .customify--cb-item-remove",function(e){e.preventDefault();var t=c(this).closest(".grid-stack-item"),i=t.closest(".customify--device-panel");t.attr("data-gs-width",1),t.attr("data-gs-x",0),t.removeAttr("style"),c(".customify-available-items",i).append(t),a.updateAllGrids(),a.save()})},encodeValue:function(e){return encodeURI(JSON.stringify(e))},decodeValue:function(e){return JSON.parse(decodeURI(e))},save:function(){var o=this;if(o.ready){var n={};_.each(o.panels,function(e,a){n[a]={},_.each(e,function(e,t){var i=_.map(c(" > .grid-stack-item",e),function(e){return e=c(e),{x:o.getX(e),y:1,width:o.getW(e),height:1,id:e.data("id")||""}});n[a][t]=i})}),l.control(o.controlId).setting.set(o.encodeValue(n))}},showPanel:function(){var t=this;this.container.removeClass("customify--builder--hide").addClass("customify--builder-show"),setTimeout(function(){var e=t.container.height();c("#customize-preview").addClass("cb--preview-panel-show").css({bottom:e-1,"margin-top":"0px"})},100)},hidePanel:function(){this.container.removeClass("customify--builder-show"),c("#customize-preview").removeClass("cb--preview-panel-show").removeAttr("style")},togglePanel:function(){var t=this;l.state("expandedPanel").bind(function(e){l.panel(n.panel).expanded()?t.showPanel():t.hidePanel()}),t.container.on("click",".customify--panel-close",function(e){e.preventDefault(),t.container.toggleClass("customify--builder--hide"),t.container.hasClass("customify--builder--hide")?c("#customize-preview").removeClass("cb--preview-panel-show"):c("#customize-preview").addClass("cb--preview-panel-show")})},panelLayoutCSS:function(){var e=c("#customize-controls").width();l.state("paneVisible").get()||(e=0),T?this.container.find(".customify--cb-inner").css({"margin-right":e}):this.container.find(".customify--cb-inner").css({"margin-left":e})},init:function(e,t,i){var a=this,o=a.getTemplate()(n,"tmpl-customify--builder-panel");a.container=c(o),c("body .wp-full-overlay").append(a.container),a.controlId=e,a.items=t,a.devices=i,n.section&&l.section(n.section).container.addClass("customify--hide"),a.addDevicePanels(),a.switchToDevice(a.activePanel),a.addAvailableItems(),a.switchToDevice(a.activePanel),a.drag_drop(),a.focus(),a.remove(),a.addExistingRowsItems(),l.panel(n.panel).expanded()?a.showPanel():a.hidePanel(),l.previewedDevice.bind(function(e){"desktop"===e?a.switchToDevice("desktop",!1):a.switchToDevice("mobile",!1)}),a.togglePanel(),l.state("paneVisible").get()&&a.panelLayoutCSS(),l.state("paneVisible").bind(function(){a.panelLayoutCSS()}),c(window).resize(_.throttle(function(){a.panelLayoutCSS()},100)),a.container.on("click",".customify--cb-devices-switcher a",function(e){e.preventDefault();var t=c(this).data("device");a.switchToDevice(t)})}};return e.init(n.control_id,n.items,n.devices),e};l.bind("ready",function(e,t){_.each(Customify_Layout_Builder.builders,function(e,t){new i(e)}),l.bind("pane-contents-reflowed",function(){setTimeout(function(){c("#sub-accordion-panel-widgets .no-widget-areas-rendered-notice .footer_moved_widgets_text").length||c("#sub-accordion-panel-widgets .no-widget-areas-rendered-notice").append('<p class="footer_moved_widgets_text">'+Customify_Layout_Builder.footer_moved_widgets_text+"</p>")},1e3)}),l.state("expandedSection").bind(function(e){c(".customify--device-panel .grid-stack-item").removeClass("item-active"),c(".customify--cb-row").removeClass("row-active"),e&&(c('.customify--cb-row[data-id="'+e.id+'"]').addClass("row-active"),c(".customify--device-panel .grid-stack-item.for-s-"+e.id).addClass("item-active"))})}),t.on("click",".focus-section",function(e){e.preventDefault();var t=c(this).attr("data-id")||"";t||(t=(t=c(this).attr("href")||"").replace("#","")),t&&l.section(t)&&l.section(t).focus()}),t.on("click",".focus-control",function(e){e.preventDefault();var t=c(this).attr("data-id")||"";t||(t=(t=c(this).attr("href")||"").replace("#","")),t&&l.control(t)&&l.control(t).focus()}),t.on("click",".focus-panel",function(e){e.preventDefault();var t=c(this).attr("data-id")||"";t||(t=(t=c(this).attr("href")||"").replace("#","")),t&&l.panel(t)&&l.panel(t).focus()}),t.on("click",".save-template-form .save-builder-template",function(e){e.preventDefault();var t=c(this).closest(".customize-control"),i=c(".template-input-name",t),a=i.val();a&&""!==a&&c.post(ajaxurl,{action:"customify_builder_save_template",name:i.val(),id:i.attr("data-builder-id")||"",control:i.attr("data-control-id")||"",preview_data:l.get()},function(e){e.success&&(i.val(""),t.find(".list-saved-templates").prepend(e.data.li),t.find(".list-saved-templates").addClass("has-templates"))})}),t.on("click",".list-saved-templates .saved_template .remove-tpl",function(e){e.preventDefault();var t=c(this).parent(),i=c(this).closest(".customize-control"),a=c(".template-input-name",i),o=t.data("id")||"";c.post(ajaxurl,{action:"customify_builder_save_template",id:a.attr("data-builder-id")||"",remove:o},function(e){t.remove(),i.find(".list-saved-templates li.saved_template").length<=0&&i.find(".list-saved-templates").removeClass("has-templates")})});t.on("click",".list-saved-templates .saved_template .load-tpl",function(e){e.preventDefault();var t=c(this).parent(),i=c.Deferred(),a=_.clone(window.location),o=t.data("control-id")||"",n=t.data("data")||{};_.isObject(n)||(n={}),_.each(n,function(e,t){var i;l.control(t)&&(_.isEmpty(e)||l.control(t).setting.set((i=e,encodeURI(JSON.stringify(i)))))});var s=c(".wp-full-overlay");s.addClass("customize-active full-overlay-active customize-loading");var r=function(){var e;if(!(0<l.state("processing").get()))return l.state("processing").unbind(r),(e=l.requestChangesetUpdate()).done(function(){c(window).off("beforeunload.customize-confirm"),top.location.href=a.origin+a.pathname+"?autofocus[control]="+o+"&url="+encodeURIComponent(l.previewer.previewUrl.get())+"&changeset_uuid="+l.settings.changeset.uuid,i.resolve()}),e.fail(function(){s.removeClass("customize-loading"),i.reject()}),i.promise()};0===l.state("processing").get()?r():l.state("processing").bind(r)}),t.on("mouseover",".customify--cb-row .grid-stack-item",function(e){var t=c(this),i=c(".customify--cb-item-remove",t).outerWidth()+c(".customify--cb-item-setting",t).outerWidth();c(".grid-stack-item-content",t).innerWidth()-50<i&&t.addClass("show-tooltip")}),t.on("mouseleave",".customify--cb-row .grid-stack-item",function(e){c(this).removeClass("show-tooltip")})}(jQuery,wp.customize||null);