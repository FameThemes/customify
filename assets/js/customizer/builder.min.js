!function(a,b){var c=a(document),d=function(d){var e={controlId:"",cols:12,cellHeight:45,items:[],container:null,ready:!1,devices:{desktop:"Desktop",mobile:"Mobile/Tablet"},activePanel:"desktop",panels:{},activeRow:"main",draggingItem:null,getTemplate:_.memoize(function(){var b,c=this,d={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e,f,g){return _.isUndefined(f)&&(f="tmpl-customize-control-"+c.type),!_.isUndefined(g)&&_.isString(g)?d.variable=g:d.variable="data",(b=_.template(a("#"+f).html(),null,d))(e)}}),drag_drop:function(){var b=this;a(".customify--device-panel",b.container).each(function(){var c=a(this),d=c.data("device"),e=[];b.panels[d]={},a(".customify--cb-items",c).each(function(b){var c,f=a(this).attr("data-id")||"";c=f?"_sid_"+d+"-"+f:"_sid_"+d+b,a(this).attr("id",c),e[b]="#"+c}),a(".grid-stack",c).each(function(){var c=a(this).attr("data-id")||"";b.panels[d][c]=a(this),a(this).droppable({out:function(a,b){},over:function(a,b){},drop:function(c,d){var e=a(this);b.gridster(e,d,c),b.save()}})});var f=a("#_sid_mobile-sidebar",c),g=f.attr("id")||!1;a(".customify-available-items .grid-stack-item",c).draggable({revert:"invalid",connectToSortable:!!g&&"#"+g,start:function(b,d){a("body").addClass("builder-item-moving"),a(".customify--cb-items",c).css("z-index",""),d.helper.parent().css("z-index",9999)},stop:function(b,d){a("body").removeClass("builder-item-moving"),a(".customify--cb-items",c).css("z-index",""),d.helper.parent().css("z-index","")}}),f.length>0&&(f.sortable({revert:!0,change:function(a,c){b.save()},receive:function(c,d){a(this).find(".grid-stack-item").removeAttr("style").attr("data-gs-width",1),b.save()}}),b.panels[d].sidebar=f),a(".customify-available-items .grid-stack-item",c).resizable({handles:"w, e",stop:function(a,c){b.setGridWidth(c.element.parent(),c),b.save()}})})},sortGrid:function(b){a(".grid-stack-item",b).each(function(){var b=a(this),c=b.attr("data-gs-x")||0;c=parseInt(c);var d=b.next();if(d.length>0){var e=d.attr("data-gs-x")||0;e=parseInt(e),c>e&&b.insertAfter(d)}})},getX:function(a){var b=a.attr("data-gs-x")||0;return parseInt(b)},getW:function(a,b){_.isUndefined(b)&&(b=!1);var c;return c=b?a.attr("data-df-width")||1:a.attr("data-gs-width")||1,parseInt(c)},findNextElFromX:function(b,c,d){for(var e=this,f=!1,g=b;!f&&g<e.cols;)c[g]>1&&(f=a('.grid-stack-item[data-gs-x="'+g+'"]',d)),g++;return f},findPrevElFromX:function(b,c,d){for(var e=!1,f=b;!e&&f>=0;)c[f]>1&&(e=a('.grid-stack-item[data-gs-x="'+f+'"]',d)),f--;return e},gridGetItemInfo:function(a,b,c){var d,e=this,f=e.getX(a),g=e.getW(a),h=0,i=0,j=!1;for(d=f-1;d>=0&&!j;)0===b[d]?h++:j=!0,d--;for(j=!1,d=f+g,console.log("start R: "+d);d<e.cols&&!j;)0===b[d]?i++:j=!0,d++;return{flag:b,x:f,w:g,item:a,before:h,after:i,id:a.attr("data-id")||"",wrapper:c}},updateItemsPositions:function(a){for(var b=this.cols,c=0;c<=b;c++)"object"!=typeof a[c]&&"function"!=typeof a[c]||a[c].attr("data-gs-x",c)},gridster:function(a,b){var c=[],d=[],e=this,f=this.cols,g=function(a){for(var b=a.x,d=a.w,e=a.el,f=b;f<b+d;f++)c[f]=f===b?e:1},h=function(a){for(var b=a.x,d=a.w,e=(a.el,b);e<b+d;e++)c[e]=0},i=function(){for(var a=0,b=0;b<f;b++)0===c[b]&&a++;return a},j=function(a,b){for(var d=0,e=a;e<f;e++)if(0===c[e])d++;else if(b)return d;return d},k=function(a,b){var d=0;void 0===b&&(b=!1);for(var e=a;e>=0;e--)if(0===c[e])d++;else if(b)return d;return d},l=function(a){return 0===c[a]},m=function(a,b){for(var d=!0,e=a;e<a+b&&d;){if(0!==c[e])return!1;e++}return d},n=function(a){if(a<0)return{x:-1,w:1};var b,d,e,f=-1;if(c[a]<=1)for(b=a,e=!1;b>=0&&!e;)1!==c[b]&&0!==c[b]&&(f=b,e=!0),b--;else f=a;for(b=f+1,d=f;1===c[b];)d++,b++;return{x:f,w:d+1-f}},o=function(a,b){var d=c.slice(),e=k(a);if(0===e)return b;var f=n(a),g=f.x>=0?f.x+f.w-1:a,h=b;h=b>e?e:b;for(var i=0,j=0,l=g;j<=h&&l>=0;)0===c[l]&&(j++,i=l),l--;var m=[],o=0;for(l=i;l<=g;l++)c[l]=0,0!==d[l]&&(m[o]=d[l],o++);for(o=0,l=i;l<=g;l++)void 0!==m[o]?c[l]=m[o]:c[l]=0,o++;return b-h},p=function(a,b){var d=c.slice(),e=j(a);if(0===e)return b;var g=n(a),h=g.x>=0?g.x:a,i=b;i=b<=e?b:e;for(var k=a,l=0,m=h;l<i&&m<f;)0===c[m]&&(l++,k=m),m++;var o=[],p=0;for(m=h;m<=k;m++)c[m]=0,0!==d[m]&&(o[p]=d[m],p++);for(p=o.length-1,m=k;m>=h;m--)void 0!==o[p]?c[m]=o[p]:c[m]=0,p--;return b-i},q=function(){e.updateItemsPositions(c)},r=function(a,b){var d=a.x,e=a.w,h=i();if(console.log("emptySlots",h),console.log("Node Width",e),h<=0)return!1;_.isUndefined(b)&&(b=!1);var r,s,t,u;if(!b){if(l(d)){if(u=e,m(d,u))return g(a),a.el.attr("data-gs-x",d),a.el.attr("data-gs-width",u),!0;for(s=j(d,!0),t=k(d-1,!0),r=s+t>=e&&e-s<=t?d-(e-s):d-t,r<0&&(r=0),console.log("_re",s),console.log("_le",t),console.log("__x",r);u>=1;){if(m(r,u))return console.log({x:r,w:u}),a.x=r,a.w=u,g(a),a.el.attr("data-gs-x",r),a.el.attr("data-gs-width",u),!0;u--}}if(1===c[d]){var v=n(d);if(v.x>=0&&d>v.x+Math.floor(v.w/2)&&d>v.x&&(r=v.x+v.w,s=j(r,!0),console.log("__re",s),console.log("__re_X",r),s>=e))return g({el:a.el,x:r,w:e}),a.el.attr("data-gs-x",r),a.el.attr("data-gs-width",e),!0}}var w=0;b?(w=p(d,e))>0&&(w=o(d-1,w)):(w=o(d,e))>0&&(w=p(d-1,w)),q(),console.log("After moved",c);for(var x,y=d,z=!1,A=0;e>=1;){if(h>=e){if(m(d,e))return console.log({x:d,w:e}),g(a),a.el.attr("data-gs-x",d),a.el.attr("data-gs-width",e),!0;for(z=!1,A=k(d,!0),y=d-A,console.log("newX",y),x=y;x<f&&!z;){if(m(x,e))return console.log("Insert in While",{x:x,w:e}),g({el:a.el,x:x,w:e}),a.el.attr("data-gs-x",x),a.el.attr("data-gs-width",e),z=!0,!0;x++}}e--}for(e=a.w,z=!1;e>=1;){for(x=0;x<f&&!z;){if(m(x,e))return console.log("Insert in While 2",{x:x,w:e}),g({el:a.el,x:x,w:e}),a.el.attr("data-gs-x",x),a.el.attr("data-gs-width",e),z=!0,!0;x++}e--}return console.log("Insert END While",{x:x,w:e}),!1},s=function(a,b){var d=(a.x,a.w);if(h(a),console.log("Swap newX",b),console.log("Swap FLAG",c),m(b,d))return g({el:a.el,x:b,w:d}),!0;n(b);r({el:a.el,x:b,w:a.w},!0)},e=this;c=e.getFlag(a),d=c.slice();var t=a.offset();e.draggingItem=b.draggable;var u,v=a.width(),w=v/e.cols,x=0,y=b.offset,z=e.getW(b.draggable,!0);console.log("DROP W",z);var A=0,B=0,C=!1;if(b.draggable.parent().is(a)?(u=!0,console.log("Item in this row")):(u=!1,console.log("Not in this row")),A=Math.round((event.clientX-t.left)/w),B=Math.round((y.left-t.left-10)/w),B<0&&(B=0),x=B,l(x))x=B,C=!0;else{for(;x<=A&&!C;)l(x)?C=!0:x++;x>A&&(x=A)}C||(x=u?B:A),delete C,x<0&&(x=0),console.log("DROP XC",A),console.log("DROP XI",B),console.log("DROP X",x);var D={el:b.draggable,x:x,w:z};D.x<=0&&(D.x=0);var E=!1;u?(D.x=parseInt(b.draggable.attr("data-gs-x")||0),D.w=parseInt(b.draggable.attr("data-gs-width")||1),console.log("swap node",D),s(D,x),E=!0):(E=r(D),console.log("Insert node")),E?(b.draggable.removeClass("item-from-list"),a.append(b.draggable),b.draggable.removeAttr("style"),console.log("DID Flag: ",c),e.draggingItem=null):(b.draggable.removeAttr("style"),console.log("Can not insert"),c=d),q(),e.updateAllGrids()},updateAllGrids:function(){var a=this;_.each(a.panels[a.activePanel],function(b,c){a.updateGridFlag(b)})},setGridWidth:function(a,b){var c=this,d=b.element,e=a.width(),f=b.size.width,g=e/c.cols,h=b.originalPosition.left>b.position.left,i=b.originalPosition.left<b.position.left,j=b.originalElement.attr("data-gs-width")||1,k=b.originalElement.attr("data-gs-x")||0;j=parseInt(j),k=parseInt(k),console.log("ow",j),console.log("ox",k);var l,m,n,o,p,q=c.getFlag(a),r=c.gridGetItemInfo(b.originalElement,q,a);if(console.log("itemInfo",r),h)return o=b.originalPosition.left-b.position.left,l=Math.ceil(o/g),l>r.before&&(l=r.before),m=k-l,n=j+l,d.attr("data-gs-x",m).removeAttr("style"),d.attr("data-gs-width",n).removeAttr("style"),void c.updateGridFlag(a);if(i)return p=b.position.left-b.originalPosition.left,l=Math.ceil(p/g),n=j-l,n<=0&&(n=1,l=0),m=k+l,d.attr("data-gs-x",m).removeAttr("style"),d.attr("data-gs-width",n).removeAttr("style"),void c.updateGridFlag(a);var s;r.x;f<b.originalSize.width?s=Math.floor(f/g):(s=Math.ceil(f/g),r.x+s>r.x+r.w+r.after&&(s=r.w+r.after)),s<=0&&(s=1),d.attr("data-gs-width",s).removeAttr("style"),c.updateGridFlag(a)},getFlag:function(a){var b,c=this,d=a.data("gridRowFlag")||[];if(_.isEmpty(d)){for(b=0;b<c.cols;b++)d[b]=0;a.data("gridRowFlag",d)}return d},updateGridFlag:function(b){var c,d=this,e=[];for(c=0;c<d.cols;c++)e[c]=0;var f;return f=a(".grid-stack-item",b),f.each(function(b){a(this).removeAttr("style");var f=d.getX(a(this)),g=d.getW(a(this));for(c=f;c<f+g;c++)e[c]=c===f?a(this):1}),b.data("gridRowFlag",e),d.updateItemsPositions(e),d.sortGrid(b),e},addNewWidget:function(b,c){var d=this,e=d.container.find(".customify--device-panel.customify--panel-"+d.activePanel),f=c;_.isObject(f)||(f=e.find(".customify--cb-items").first());var g=b;g.draggable({revert:"invalid",appendTo:e,scroll:!1,zIndex:99999,handle:".grid-stack-item-content",start:function(b,c){a("body").addClass("builder-item-moving"),a(".customify--cb-items",e).css("z-index",""),c.helper.parent().css("z-index",9999)},stop:function(b,c){a("body").removeClass("builder-item-moving"),a(".customify--cb-items",e).css("z-index",""),d.save()},drag:function(a,b){}}).resizable({handles:"w, e",stop:function(a,b){d.setGridWidth(b.element.parent(),b),d.save()}}),f.append(g),d.updateGridFlag(f)},addPanel:function(b){var c=this,e=c.getTemplate(),f="tmpl-customify--cb-panel";if(0!=a("#"+f).length){_.isObject(d.rows)||(d.rows={});return'<div class="customify--device-panel customify-vertical-panel customify--panel-'+b+'" data-device="'+b+'">'+e({device:b,id:d.id,rows:d.rows},f)+"</div>"}},addDevicePanels:function(){var b=this;_.each(b.devices,function(c,d){var e=b.addPanel(d);a(".customify--cb-devices-switcher",b.container).append('<a href="#" class="switch-to-'+d+'" data-device="'+d+'">'+c+"</a>"),a(".customify--cb-body",b.container).append(e)})},addItem:function(b){var c=this,d=c.getTemplate(),e="tmpl-customify--cb-item";if(0!=a("#"+e).length){var f=d(b,e);return a(f)}},addAvailableItems:function(){var b=this;_.each(b.devices,function(c,d){var e=a('<div class="customify-available-items" data-device="'+d+'"></div>');a(".customify--panel-"+d,b.container).append(e),_.each(b.items,function(a){var c=!0;if(!_.isUndefined(a.devices)&&!_.isEmpty(a.devices))if(_.isString(a.devices))a.devices!=d&&(c=!1);else{var f=!1;_.each(a.devices,function(a){d==a&&(f=!0)}),f||(c=!1)}if(c){var g=b.addItem(a);e.append(g)}})})},switchToDevice:function(b,c){var d=this;_.size(d.devices)>1?(a(".customify--cb-devices-switcher a",d.container).removeClass("customify--tab-active"),a(".customify--cb-devices-switcher .switch-to-"+b,d.container).addClass("customify--tab-active"),a(".customify--device-panel",d.container).addClass("customify--panel-hide"),a(".customify--device-panel.customify--panel-"+b,d.container).removeClass("customify--panel-hide"),d.activePanel=b):a(".customify--cb-devices-switcher a",d.container).addClass("customify--tab-active"),(_.isUndefined(c)||c)&&("desktop"==b?a("#customize-footer-actions .preview-desktop").trigger("click"):a("#customize-footer-actions .preview-mobile").trigger("click"))},addExistingRowsItems:function(){var c=this,d=b.control(c.controlId).params.value;_.isObject(d)||(d={}),_.each(c.panels,function(b,e){var f={};_.isObject(d[e])&&(f=d[e]),_.each(f,function(d,f){_.isUndefined(d)||_.each(d,function(d,g){var h=a('.customify-available-items[data-device="'+e+'"] .grid-stack-item[data-id="'+d.id+'"]').first();h.attr("data-gs-width",d.width),h.attr("data-gs-x",d.x),h.removeClass("item-from-list"),c.addNewWidget(h,b[f])})})}),c.ready=!0},focus:function(){this.container.on("click",".customify--cb-item-setting, .customify--cb-item-name",function(c){c.preventDefault();var d=a(this).data("section")||"",e=a(this).attr("data-control")||"",f=!1;e&&(_.isUndefined(b.control(e))||(b.control(e).focus(),f=!0)),f||d&&!_.isUndefined(b.section(d))&&(b.section(d).focus(),f=!0)}),this.container.on("click",".customify--cb-row-settings",function(c){c.preventDefault();var e=a(this).attr("data-id")||"",f=d.id+"_"+e;_.isUndefined(b.section(f))||b.section(f).focus()})},remove:function(){var b=this;c.on("click",".customify--device-panel .customify--cb-item-remove",function(c){c.preventDefault();var d=a(this).closest(".grid-stack-item"),e=d.closest(".customify--device-panel");d.attr("data-gs-width",1),d.attr("data-gs-x",0),d.removeAttr("style"),a(".customify-available-items",e).append(d),b.updateAllGrids(),b.save()})},encodeValue:function(a){return encodeURI(JSON.stringify(a))},decodeValue:function(a){return JSON.parse(decodeURI(a))},save:function(){var c=this;if(c.ready){var d={};_.each(c.panels,function(b,e){d[e]={},_.each(b,function(b,f){var g=_.map(a(" > .grid-stack-item",b),function(b){return b=a(b),{x:c.getX(b),y:1,width:c.getW(b),height:1,id:b.data("id")||""}});d[e][f]=g})}),b.control(c.controlId).setting.set(c.encodeValue(d))}},showPanel:function(){var b=this;this.container.removeClass("customify--builder--hide").addClass("customify--builder-show"),setTimeout(function(){var c=b.container.height();a("#customize-preview").addClass("cb--preview-panel-show").css({bottom:c-1,"margin-top":"0px"})},100)},hidePanel:function(){this.container.removeClass("customify--builder-show"),a("#customize-preview").removeClass("cb--preview-panel-show").removeAttr("style")},togglePanel:function(){var c=this;b.state("expandedPanel").bind(function(a){b.panel(d.panel).expanded()?c.showPanel():c.hidePanel()}),c.container.on("click",".customify--panel-close",function(b){b.preventDefault(),c.container.toggleClass("customify--builder--hide"),c.container.hasClass("customify--builder--hide")?a("#customize-preview").removeClass("cb--preview-panel-show"):a("#customize-preview").addClass("cb--preview-panel-show")})},panelLayoutCSS:function(){var c=a("#customize-controls").width();b.state("paneVisible").get()||(c=0),this.container.find(".customify--cb-inner").css({"margin-left":c})},init:function(c,e,f){var g=this,h=g.getTemplate(),i="tmpl-customify--builder-panel",j=h(d,i);g.container=a(j),a("body .wp-full-overlay").append(g.container),g.controlId=c,g.items=e,g.devices=f,d.section&&b.section(d.section).container.addClass("customify--hide"),g.addDevicePanels(),g.switchToDevice(g.activePanel),g.addAvailableItems(),g.switchToDevice(g.activePanel),g.drag_drop(),g.focus(),g.remove(),g.addExistingRowsItems(),b.panel(d.panel).expanded()?g.showPanel():g.hidePanel(),b.previewedDevice.bind(function(a){"desktop"===a?g.switchToDevice("desktop",!1):g.switchToDevice("mobile",!1)}),g.togglePanel(),b.state("paneVisible").get()&&g.panelLayoutCSS(),b.state("paneVisible").bind(function(){g.panelLayoutCSS()}),a(window).resize(_.throttle(function(){g.panelLayoutCSS()},100)),g.container.on("click",".customify--cb-devices-switcher a",function(b){b.preventDefault();var c=a(this).data("device");g.switchToDevice(c)})}};return e.init(d.control_id,d.items,d.devices),e};b.bind("ready",function(c,e){_.each(Customify_Layout_Builder.builders,function(a,b){new d(a)}),b.bind("pane-contents-reflowed",function(){setTimeout(function(){a("#sub-accordion-panel-widgets .no-widget-areas-rendered-notice .footer_moved_widgets_text").length||a("#sub-accordion-panel-widgets .no-widget-areas-rendered-notice").append('<p class="footer_moved_widgets_text">'+Customify_Layout_Builder.footer_moved_widgets_text+"</p>")},1e3)}),b.state("expandedSection").bind(function(b){a(".customify--device-panel .grid-stack-item").removeClass("item-active"),a(".customify--cb-row").removeClass("row-active"),b&&(a('.customify--cb-row[data-id="'+b.id+'"]').addClass("row-active"),a(".customify--device-panel .grid-stack-item.for-s-"+b.id).addClass("item-active"))})}),c.on("click",".focus-section",function(c){c.preventDefault();var d=a(this).attr("data-id")||"";d||(d=a(this).attr("href")||"",d=d.replace("#","")),d&&b.section(d)&&b.section(d).focus()}),c.on("click",".focus-control",function(c){c.preventDefault();var d=a(this).attr("data-id")||"";d||(d=a(this).attr("href")||"",d=d.replace("#","")),d&&b.control(d)&&b.control(d).focus()}),c.on("click",".focus-panel",function(c){c.preventDefault();var d=a(this).attr("data-id")||"";d||(d=a(this).attr("href")||"",d=d.replace("#","")),d&&b.panel(d)&&b.panel(d).focus()}),c.on("click",".save-template-form .save-builder-template",function(c){c.preventDefault();var d=a(this).closest(".customize-control"),e=a(".template-input-name",d),f=e.val();f&&""!==f&&a.post(ajaxurl,{action:"customify_builder_save_template",name:e.val(),id:e.attr("data-builder-id")||"",control:e.attr("data-control-id")||"",preview_data:b.get()},function(a){a.success&&(e.val(""),d.find(".list-saved-templates").prepend(a.data.li),d.find(".list-saved-templates").addClass("has-templates"))})}),c.on("click",".list-saved-templates .saved_template .remove-tpl",function(b){b.preventDefault();var c=a(this).parent(),d=a(this).closest(".customize-control"),e=a(".template-input-name",d),f=c.data("id")||"";a.post(ajaxurl,{action:"customify_builder_save_template",id:e.attr("data-builder-id")||"",remove:f},function(a){c.remove(),d.find(".list-saved-templates li.saved_template").length<=0&&d.find(".list-saved-templates").removeClass("has-templates")})});var e=function(a){return encodeURI(JSON.stringify(a))};c.on("click",".list-saved-templates .saved_template .load-tpl",function(c){c.preventDefault();var d=a(this).parent(),f=a.Deferred(),g=_.clone(window.location),h=d.data("control-id")||"",i=d.data("data")||{};_.isObject(i)||(i={}),_.each(i,function(a,c){b.control(c)&&b.control(c).setting.set(e(a))});var j=a(".wp-full-overlay");j.addClass("customize-loading");var k=function(){var c;if(!(b.state("processing").get()>0))return b.state("processing").unbind(k),c=b.requestChangesetUpdate(),c.done(function(){a(window).off("beforeunload.customize-confirm"),top.location.href=g.origin+g.pathname+"?autofocus[control]="+h+"&url="+encodeURIComponent(b.previewer.previewUrl.get())+"&changeset_uuid="+b.settings.changeset.uuid,f.resolve()}),c.fail(function(){j.removeClass("customize-loading"),f.reject()}),f.promise()};0===b.state("processing").get()?k():b.state("processing").bind(k)}),c.on("mouseover",".customify--cb-row .grid-stack-item",function(b){var c=a(this);a(".customify--cb-item-remove",c).outerWidth()+a(".customify--cb-item-setting",c).outerWidth()>a(".grid-stack-item-content",c).innerWidth()-50&&c.addClass("show-tooltip")}),c.on("mouseleave",".customify--cb-row .grid-stack-item",function(b){a(this).removeClass("show-tooltip")})}(jQuery,wp.customize||null);